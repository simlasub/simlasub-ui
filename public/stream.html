<!DOCTYPE html>

<html>
<header>
	<meta charset="utf-8">
	<title>SIMLASUB</title>
	<meta name="viewport" content="width=device-width">

	<script type="text/javascript" src="jmuxer.js"></script>

	<!-- load stylesheet -->
	<link rel="stylesheet" href="style.css">
</header>

<body class="flex">
	<div class="box">
		<video id="player"></video>	
	</div>
</body>


<script>
	var jmuxer = new JMuxer({
		node: "player",
		mode: "video", /* available values are: both, audio and video */
		debug: true,
		fps: 30
	});

	ws = new WebSocket("ws://" + location.hostname + ":1234");
	ws.binaryType = "arraybuffer";

	ws.onmessage = function(event) {
		var data = new Uint8Array(event.data);

		if(data.length === 0) {	
			console.warn("empty packet received");
			return;
		}

		console.log(data);

		jmuxer.feed(parse(data));
	}

	function parse(input) {
		var dv = new DataView(input.buffer),
			duration,
			audioLength,
			audio,
			video;

		duration = dv.getUint16(0, true);
		audioLength = dv.getUint16(2, true);
		audio = input.subarray(4, (audioLength + 4));
		video = input.subarray(audioLength + 4);

		return {
			video: video,
			duration: duration
		};
	}
	</script>

</html>